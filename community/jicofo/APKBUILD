# Contributor:
# Maintainer: Mathieu Kerjouan <contact@steepath.eu>
pkgname=jicofo
pkgver=4548
pkgrel=0
pkgdesc="jitsi jicofo service"
url="https://jitsi.org"
arch="all"
license="Apache-2.0"
depends="openjdk8-jre"
makedepends="openjdk8 openjdk8-jre maven unzip"
install="$pkgname.pre-install $pkgname.post-install"
subpackages=""
source="
	https://github.com/jitsi/jicofo/archive/stable/jitsi-meet_${pkgver}.zip
	jicofo.initd
	jicofo.confd
	"

build() {
	cd "jicofo-stable-jitsi-meet_${pkgver}"
	# maven surefire is crashing during test execution on Alpine Linux
	# SIGSEV (0xb) ...
	# probably crashing when executing ColibriTest suite
	# and probably due to SCTP lib (natively builded?) and 
	# not compatible with musl. The library seems to be usrsctp 
	# directly build with JNI support and packaged in jitsi-sctp.
	mvn -B package -D"maven.test.skip=true" --file pom.xml
	unzip target/jicofo-1.1-SNAPSHOT-archive.zip
}

check() {
	echo wip
}

package() {

	install -m755 -D "$srcdir"/$pkgname.initd \
		"$pkgdir"/etc/init.d/$pkgname
	install -m644 -D "$srcdir"/$pkgname.confd \
		"$pkgdir"/etc/conf.d/$pkgname
}

sha512sums="6839e9c876b139d4755b0dcc11bc7942ce9c27a9f60f54ec0179a7a82f284f0ec9de6dc21fc664a02d3b67325fd937465c0d0b2f111547de0f09ba6ce53af24c  jitsi-meet_4548.zip
512331fd6b4c5621c14b8bf07a94b2318dc33fea245de1e66d6385e1dc4cbfde7cb0d53507b46c85a11defe65a936cca40ace80df76130c7af2ef5999899892c  jicofo.initd
f11f0d192cd7823307c2ce4ddc7b3fff5190f72d3f65a5524b487021a95a222aca1fd36ab1eb58ed533e7acd555bfb70f0c8a13db20338ea31527f3151fd2bd7  jicofo.confd"
